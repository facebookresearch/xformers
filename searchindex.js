Search.setIndex({"docnames": ["components/index", "components/ops", "index", "what_is_xformers"], "filenames": ["components/index.rst", "components/ops.rst", "index.rst", "what_is_xformers.rst"], "titles": ["API Reference", "xFormers optimized operators", "Welcome to xFormers\u2019s documentation!", "What is xFormers?"], "terms": {"xformer": 0, "optim": [0, 2, 3], "oper": [0, 2], "memori": 0, "effici": 0, "attent": 0, "class": 1, "op": 1, "attentionopbas": 1, "sourc": [1, 3], "base": [1, 2], "baseoper": 1, "ani": [1, 3], "see": 1, "fmha": 1, "cutlass": 1, "fwop": 1, "bwop": 1, "flash": 1, "triton": 1, "classmethod": 1, "not_supported_reason": 1, "d": 1, "input": 1, "list": 1, "str": 1, "return": 1, "reason": 1, "why": 1, "thi": [1, 3], "support": 1, "The": 1, "kernel": 1, "can": [1, 2, 3], "run": 1, "onli": 1, "empti": 1, "memory_efficient_attent": 1, "queri": 1, "tensor": 1, "kei": 1, "valu": [1, 3], "attn_bia": 1, "option": [1, 2], "union": 1, "attentionbia": 1, "none": 1, "p": 1, "float": 1, "0": 1, "scale": 1, "tupl": 1, "type": 1, "attentionfwopbas": 1, "attentionbwopbas": 1, "output_dtyp": 1, "dtype": 1, "mechan": 1, "follow": [1, 3], "self": 1, "doe": 1, "Not": 1, "need": 1, "o": 1, "n": 1, "2": 1, "shape": 1, "must": 1, "format": 1, "b": 1, "m": 1, "h": 1, "k": 1, "where": 1, "batch": 1, "size": 1, "sequenc": 1, "length": 1, "number": 1, "head": 1, "embed": 1, "per": 1, "If": 1, "have": 1, "dimens": 1, "3": 1, "assum": 1, "ar": [1, 2, 3], "1": 1, "also": [1, 3], "5": 1, "gqa": 1, "note": 1, "below": 1, "contigu": 1, "we": 1, "requir": 1, "last": 1, "s": 1, "stride": 1, "equival": 1, "pytorch": [1, 2], "code": 1, "transpos": 1, "attn": 1, "softmax": 1, "f": 1, "dropout": 1, "exampl": 1, "import": 1, "xop": 1, "comput": 1, "regular": 1, "y": 1, "q": 1, "v": 1, "With": 1, "causal": 1, "lowertriangularmask": 1, "hardwar": 1, "nvidia": 1, "gpu": 1, "capabl": 1, "abov": 1, "6": 1, "p100": 1, "datatyp": 1, "f16": 1, "bf16": 1, "f32": 1, "experiment": 1, "us": 1, "multi": 1, "mqa": 1, "group": 1, "an": 1, "featur": 1, "forward": 1, "pass": 1, "you": [1, 3], "16": 1, "provid": 1, "dim": 1, "g": 1, "here": 1, "8": 1, "pleas": 1, "automat": [1, 3], "broadcast": 1, "so": [1, 3], "manual": 1, "befor": 1, "call": 1, "torch": 1, "32": 1, "128": 1, "kwarg": 1, "dict": 1, "devic": 1, "cuda": 1, "float16": 1, "randn": 1, "out_gqa": 1, "reshap": 1, "4": 1, "expand": 1, "rais": 1, "notimplementederror": 1, "mha": 1, "valueerror": 1, "invalid": 1, "paramet": 1, "mq": 1, "mkv": 1, "kv": 1, "bia": 1, "appli": 1, "matrix": 1, "default": 1, "mask": 1, "For": 1, "common": 1, "arbitrari": 1, "slower": 1, "probabl": 1, "disabl": 1, "set": 1, "factor": 1, "recommend": 1, "dispatch": 1, "best": 1, "depend": 1, "larg": 1, "includ": 1, "without": 1, "tensorcor": 1, "old": 1, "sm60": 1, "ck": 1, "compos": [1, 3], "file": 1, "contain": 1, "argument": 1, "essenti": 1, "which": [1, 2, 3], "ad": 1, "t": 1, "goal": 1, "custom": 1, "made": 1, "instead": 1, "dens": 1, "want": 1, "avoid": 1, "load": 1, "from": 1, "perform": 1, "abl": 1, "know": 1, "hand": 1, "part": [1, 2], "eg": 1, "some": [1, 2], "veri": 1, "blockdiagonalmask": 1, "object": 1, "That": 1, "function": 1, "ha": 1, "abil": 1, "add": 1, "qk": 1, "calcul": 1, "n_queri": 1, "given": [1, 3], "most": 1, "case": 1, "zero": 1, "neg": 1, "infin": 1, "form": 1, "attend": 1, "children": 1, "defin": [1, 3], "altern": 1, "thing": 1, "when": 1, "materi": 1, "hardcod": 1, "better": 1, "lowertriangularfrombottomrightmask": 1, "lowertriangularmaskwithtensorbia": 1, "blockdiagonalcausalmask": 1, "int": 1, "float32": 1, "cpu": 1, "slow": 1, "don": 1, "attempt": 1, "make": 1, "fast": [1, 3], "debug": 1, "test": [1, 3], "should": 1, "like": 1, "q_seqlen": 1, "k_seqlen": 1, "A": 1, "lower": 1, "triangular": 1, "aka": 1, "cannot": [1, 3], "farther": 1, "initi": 1, "than": 1, "equal": 1, "add_bia": 1, "creat": [1, 2], "new": [1, 3], "localattentionfrombottomrightmask": 1, "window_left": 1, "window_right": 1, "local": [1, 3], "posit": 1, "window": 1, "_left": 1, "_right": 1, "num": 1, "_queri": 1, "_kei": 1, "print": 1, "exp": 1, "4x4": 1, "4x5": 1, "illustr": 1, "total": 1, "exactli": 1, "same": 1, "differ": 1, "shift": 1, "In": 1, "other": [1, 3], "word": 1, "nearer": 1, "final": 1, "between": 1, "left": 1, "right": 1, "thei": [1, 2], "becom": 1, "make_local_attent": 1, "window_s": 1, "lowertriangularfrombottomrightlocalattentionmask": 1, "combin": [1, 2], "_window_s": 1, "both": 1, "whose": 1, "distanc": 1, "x": 1, "either": 1, "less": 1, "i": 1, "e": 1, "greater": 1, "green": 1, "area": 1, "grei": 1, "out": 1, "addit": 1, "q_seqinfo": 1, "_seqleninfo": 1, "k_seqinfo": 1, "_batch_siz": 1, "block": [1, 2, 3], "diagon": 1, "each": [1, 3], "divid": 1, "handl": 1, "via": 1, "from_tensor_list": 1, "list_x": 1, "linear": 1, "nn": 1, "unbind": 1, "list_out": 1, "split": 1, "assert": 1, "from_seqlen": 1, "kv_seqlen": 1, "concaten": 1, "back": 1, "vari": 1, "m_i": 1, "all": [1, 3], "correspond": 1, "along": 1, "sum_i": 1, "invers": 1, "token": 1, "possibl": 1, "make_caus": 1, "make_causal_from_bottomright": 1, "blockdiagonalcausalfrombottomrightmask": 1, "prefix": 1, "blockdiagonalcausallocalattentionmask": 1, "make_local_attention_from_bottomright": 1, "blockdiagonalcausallocalattentionfrombottomrightmask": 1, "start": 1, "bottom": 1, "except": 1, "nor": 1, "one": [1, 3], "allow": [1, 3], "num_kei": 1, "num_queri": 1, "otherwis": 1, "vector": 1, "inf": 1, "blockdiagonalpaddedkeysmask": 1, "_paddedseqleninfo": 1, "pad": 1, "space": 1, "12": 1, "three": 1, "max": 1, "first": 1, "kv_pad": 1, "causal_diagon": 1, "upperbound": 1, "individu": 1, "unus": 1, "bc": 1, "blockdiagonalcausalwithoffsetpaddedkeysmask": 1, "offset": 1, "blockdiagonallocalattentionpaddedkeysmask": 1, "blockdiagonalcausallocalattentionpaddedkeysmask": 1, "more": [1, 3], "further": 1, "least": 1, "pagedblockdiagonalpaddedkeysmask": 1, "block_tabl": 1, "page_s": 1, "page": 1, "batch_siz": 1, "max_num_pag": 1, "num_head": 1, "head_dim": 1, "num_group": 1, "pagedblockdiagonalcausalwithoffsetpaddedkeysmask": 1, "blockdiagonalgappykeysmask": 1, "_gappyseqinfo": 1, "gappi": 1, "kv_seqstart": 1, "make_pag": 1, "notional_pad": 1, "paged_typ": 1, "pagedblockdiagonalgappykeysmask": 1, "our": 1, "actual": 1, "live": 1, "separ": 1, "convert": 1, "version": 1, "sync": 1, "blockdiagonalcausalwithoffsetgappykeysmask": 1, "unlik": 1, "address": 1, "element": 1, "were": 1, "do": 1, "two": 1, "100": 1, "chang": 1, "ignor": 1, "would": 1, "101": 1, "200": 1, "But": 1, "pagedblockdiagonalcausalwithoffsetgappykeysmask": 1, "pattern": 1, "band": 1, "ith": 1, "its": 1, "index": 1, "j": 1, "those": 1, "memory_efficient_attention_parti": 1, "output": 1, "lse": 1, "style": 1, "extra": 1, "data": 1, "log": 1, "sum": 1, "merg": 1, "merge_attent": 1, "obtain": 1, "against": [1, 3], "disjoint": 1, "doesn": 1, "backward": 1, "attn_split": 1, "lse_split": 1, "write_ls": 1, "bool": 1, "true": 1, "get": 1, "whole": 1, "http": 1, "arxiv": 1, "org": 1, "ab": 1, "2402": 1, "05099": 1, "result": 1, "out_ful": 1, "out1": 1, "lse1": 1, "out2": 1, "lse2": 1, "lse_ful": 1, "chunk": 1, "kq": 1, "singl": 1, "num_chunk": 1, "whether": 1, "attn_out": 1, "lse_out": 1, "memory_efficient_attention_backward": 1, "grad": 1, "gradient": 1, "dq": 1, "dk": 1, "dv": 1, "explan": 1, "memory_efficient_attention_forward_requires_grad": 1, "memory_efficient_attention_forward": 1, "later": 1, "librari": [2, 3], "host": 2, "flexibl": [2, 3], "transform": [2, 3], "interoper": [2, 3], "build": [2, 3], "state": [2, 3], "art": [2, 3], "model": [2, 3], "api": 2, "refer": [2, 3], "focus": 3, "field": 3, "agnost": 3, "design": 3, "ideal": 3, "break": 3, "inspir": 3, "zoo": 3, "studi": 3, "ablat": 3, "architectur": 3, "search": 3, "extens": 3, "aim": 3, "being": 3, "easi": 3, "extend": 3, "focu": 3, "specif": 3, "improv": 3, "easili": 3, "compar": 3, "reus": 3, "across": 3, "domain": 3, "mean": 3, "engin": 3, "effort": 3, "And": 3, "sinc": 3, "measur": 3, "benchmark": 3, "heavi": 3, "everi": 3, "variant": 3, "repo": 3, "alon": 3, "relev": 3, "happen": 3, "anytim": 3, "somebodi": 3, "propos": 3, "through": 3, "pr": 3, "crowd": 3, "realli": 3, "welcom": 3, "move": 3, "too": 3, "anyth": 3}, "objects": {"xformers": [[1, 0, 0, "-", "ops"]], "xformers.ops": [[1, 1, 1, "", "AttentionOpBase"], [1, 0, 0, "module-0", "fmha"], [1, 3, 1, "", "memory_efficient_attention"]], "xformers.ops.AttentionOpBase": [[1, 2, 1, "", "not_supported_reasons"]], "xformers.ops.fmha": [[1, 0, 0, "-", "attn_bias"], [1, 0, 0, "-", "ck"], [1, 0, 0, "-", "ck_splitk"], [1, 0, 0, "-", "cutlass"], [1, 0, 0, "-", "flash"], [1, 3, 1, "", "memory_efficient_attention_backward"], [1, 3, 1, "", "memory_efficient_attention_forward"], [1, 3, 1, "", "memory_efficient_attention_forward_requires_grad"], [1, 3, 1, "", "memory_efficient_attention_partial"], [1, 3, 1, "", "merge_attentions"]], "xformers.ops.fmha.attn_bias": [[1, 1, 1, "", "AttentionBias"], [1, 1, 1, "", "BlockDiagonalCausalFromBottomRightMask"], [1, 1, 1, "", "BlockDiagonalCausalLocalAttentionFromBottomRightMask"], [1, 1, 1, "", "BlockDiagonalCausalLocalAttentionMask"], [1, 1, 1, "", "BlockDiagonalCausalLocalAttentionPaddedKeysMask"], [1, 1, 1, "", "BlockDiagonalCausalMask"], [1, 1, 1, "", "BlockDiagonalCausalWithOffsetGappyKeysMask"], [1, 1, 1, "", "BlockDiagonalCausalWithOffsetPaddedKeysMask"], [1, 1, 1, "", "BlockDiagonalGappyKeysMask"], [1, 1, 1, "", "BlockDiagonalLocalAttentionPaddedKeysMask"], [1, 1, 1, "", "BlockDiagonalMask"], [1, 1, 1, "", "BlockDiagonalPaddedKeysMask"], [1, 1, 1, "", "LocalAttentionFromBottomRightMask"], [1, 1, 1, "", "LowerTriangularFromBottomRightLocalAttentionMask"], [1, 1, 1, "", "LowerTriangularFromBottomRightMask"], [1, 1, 1, "", "LowerTriangularMask"], [1, 1, 1, "", "LowerTriangularMaskWithTensorBias"], [1, 1, 1, "", "PagedBlockDiagonalCausalWithOffsetGappyKeysMask"], [1, 1, 1, "", "PagedBlockDiagonalCausalWithOffsetPaddedKeysMask"], [1, 1, 1, "", "PagedBlockDiagonalGappyKeysMask"], [1, 1, 1, "", "PagedBlockDiagonalPaddedKeysMask"]], "xformers.ops.fmha.attn_bias.AttentionBias": [[1, 2, 1, "", "materialize"]], "xformers.ops.fmha.attn_bias.BlockDiagonalCausalWithOffsetGappyKeysMask": [[1, 2, 1, "", "materialize"]], "xformers.ops.fmha.attn_bias.BlockDiagonalCausalWithOffsetPaddedKeysMask": [[1, 2, 1, "", "from_seqlens"]], "xformers.ops.fmha.attn_bias.BlockDiagonalGappyKeysMask": [[1, 2, 1, "", "from_seqlens"], [1, 2, 1, "", "make_paged"], [1, 2, 1, "", "materialize"]], "xformers.ops.fmha.attn_bias.BlockDiagonalMask": [[1, 2, 1, "", "from_seqlens"], [1, 2, 1, "", "from_tensor_list"], [1, 2, 1, "", "make_causal"], [1, 2, 1, "", "make_causal_from_bottomright"], [1, 2, 1, "", "make_local_attention"], [1, 2, 1, "", "make_local_attention_from_bottomright"], [1, 2, 1, "", "materialize"], [1, 2, 1, "", "split"]], "xformers.ops.fmha.attn_bias.BlockDiagonalPaddedKeysMask": [[1, 2, 1, "", "from_seqlens"], [1, 2, 1, "", "materialize"]], "xformers.ops.fmha.attn_bias.LowerTriangularFromBottomRightMask": [[1, 2, 1, "", "make_local_attention"]], "xformers.ops.fmha.attn_bias.LowerTriangularMask": [[1, 2, 1, "", "add_bias"]], "xformers.ops.fmha.attn_bias.PagedBlockDiagonalGappyKeysMask": [[1, 2, 1, "", "from_seqlens"], [1, 2, 1, "", "materialize"]], "xformers.ops.fmha.attn_bias.PagedBlockDiagonalPaddedKeysMask": [[1, 2, 1, "", "from_seqlens"], [1, 2, 1, "", "materialize"]], "xformers.ops.fmha.ck": [[1, 1, 1, "", "BwOp"], [1, 1, 1, "", "FwOp"]], "xformers.ops.fmha.cutlass": [[1, 1, 1, "", "BwOp"], [1, 1, 1, "", "FwOp"]], "xformers.ops.fmha.flash": [[1, 1, 1, "", "BwOp"], [1, 1, 1, "", "FwOp"]]}, "objtypes": {"0": "py:module", "1": "py:class", "2": "py:method", "3": "py:function"}, "objnames": {"0": ["py", "module", "Python module"], "1": ["py", "class", "Python class"], "2": ["py", "method", "Python method"], "3": ["py", "function", "Python function"]}, "titleterms": {"api": 0, "refer": 0, "xformer": [1, 2, 3], "optim": 1, "oper": 1, "memori": 1, "effici": 1, "attent": 1, "avail": 1, "implement": 1, "bias": 1, "partial": 1, "non": 1, "autograd": 1, "welcom": 2, "s": 2, "document": 2, "compon": 2, "what": 3}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 6, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx.ext.intersphinx": 1, "sphinx.ext.todo": 2, "sphinx.ext.viewcode": 1, "sphinx": 56}})